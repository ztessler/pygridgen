

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic grid generation &mdash; pygridgen 0.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pygridgen 0.2.0 documentation" href="../index.html"/>
        <link rel="next" title="Examples from the gridgen-c library" href="gridgen_examples.html"/>
        <link rel="prev" title="Mac OS X: building from source" href="../install/build_osx.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> pygridgen</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/conda.html">Installation via conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/build_linux.html">Linux: Building from source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/build_linux.html#basic-linux-stuff">Basic linux stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_linux.html#getting-miniconda-and-creating-an-environment">Getting miniconda and creating an environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_linux.html#cloning-dependencies-from-github">Cloning dependencies from github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_linux.html#building-c-c-dependencies">Building C/C++ dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_linux.html#install-pygridgen">Install pygridgen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/build_osx.html">Mac OS X: building from source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/build_osx.html#basic-stuff">Basic stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_osx.html#getting-miniconda-and-creating-an-environment">Getting miniconda and creating an environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_osx.html#cloning-dependencies-from-github">Cloning dependencies from github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_osx.html#building-c-c-dependencies">Building C/C++ dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/build_osx.html#install-pygridgen">Install pygridgen</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Basic grid generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#side-channels-using">Side channels: using <span class="math">\(\beta = -1\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-focus">Using focus</a></li>
<li class="toctree-l2"><a class="reference internal" href="#on-the-upper-left-index-parameter">On the upper left index parameter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gridgen_examples.html">Examples from the gridgen-c library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gridgen_examples.html#sensitivity-to">Sensitivity to <span class="math">\(\beta\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="gridgen_examples.html#basic-estuary">Basic Estuary</a></li>
<li class="toctree-l2"><a class="reference internal" href="gridgen_examples.html#these-are-just-weird">These are just weird</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/grid.html">The <cite>pygridgen</cite> API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/csa.html">The <cite>csa</cite> API</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">pygridgen</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Basic grid generation</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorial/basics.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="basic-grid-generation">
<h1>Basic grid generation<a class="headerlink" href="#basic-grid-generation" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre>import warnings
warnings.simplefilter(&#39;ignore&#39;)

import numpy
from matplotlib import pyplot
import seaborn
clear_bkgd = {&#39;axes.facecolor&#39;:&#39;none&#39;, &#39;figure.facecolor&#39;:&#39;none&#39;}
seaborn.set(style=&#39;ticks&#39;, context=&#39;notebook&#39;, rc=clear_bkgd)

import pygridgen
%matplotlib inline

def plot_grid(grid, ax):
    ax.plot(grid.x.flatten(), grid.y.flatten(), &#39;k.&#39;, label=&#39;Grid nodes&#39;, zorder=5)
    ax.set_aspect(&#39;equal&#39;)
    ax.set_xlim([0, 4])
    ax.set_ylim([0, 4])
    ax.plot(grid.xbry, grid.ybry, &#39;-&#39;, color=&#39;0.5&#39;, zorder=0)
    pos = numpy.nonzero(grid.beta == 1)
    neg = numpy.nonzero(grid.beta == -1)

    ax.plot(x[pos], y[pos], &#39;go&#39;, label=&#39;Positive&#39;, zorder=2, alpha=0.5)
    ax.plot(x[neg], y[neg], &#39;rs&#39;, label=&#39;Negative&#39;, zorder=2, alpha=0.5)

    ax.legend(numpoints=1)
</pre></div>
</div>
<p>Two basic quantities define the domain of a grid: the boundary
coordinates (x &amp; y) and the <span class="math">\(\beta\)</span> parameters. The <span class="math">\(\beta\)</span>
parameter describes the direction of the turning at each boundary point
and the sum of all beta parameters must be 4 for a given boundary.</p>
<p>Conceptually, the boundaries are always traversed counter clockwise.
Thus, if the boundary turns in a positive direction (according to the
<a class="reference external" href="https://en.wikipedia.org/wiki/Right-hand_rule">right-hand rule</a>),
it&#8217;s working to close the boundary and <span class="math">\(\beta = +1\)</span>. Conversely,
if the turning works to keep the boundary open and creates a side
channel, <span class="math">\(\beta = -1\)</span>. Neutral points that don&#8217;t actively close or
open the boundary are assigned values of <span class="math">\(0\)</span>.</p>
<p>In other words, in a simple, concave shape have four points where
<span class="math">\(\beta = +1\)</span> that act to define a pseudo-rectangle of curvi-linear
space.</p>
<p>And then, obviously, you define the number of rows and columns of nodes
in the grid as two-tuple called <code class="docutils literal"><span class="pre">shape</span></code>.</p>
<p>Let&#8217;s look at a simple trapzoid as the most basic of examples.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cols</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_3_0.png" src="../_images/basics_3_0.png" />
<p>Without dramatically changing anything, we can add a neutral point to
make a pentagon.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_5_0.png" src="../_images/basics_5_0.png" />
<div class="section" id="side-channels-using">
<h2>Side channels: using <span class="math">\(\beta = -1\)</span><a class="headerlink" href="#side-channels-using" title="Permalink to this headline">¶</a></h2>
<p>If you have complex shapes with side channels, and don&#8217;t define an
negative turning points, you&#8217;ll likely get undesired results. In the
example below, the grid does not work it&#8217;s way into the right side
channel.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_7_0.png" src="../_images/basics_7_0.png" />
<p>The first thing we might try, is put two of the <span class="math">\(\beta = +1\)</span>
values in the out corners of the side channel. But, again, this really
isn&#8217;t want we want</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_9_0.png" src="../_images/basics_9_0.png" />
<p>The trick here is to use <span class="math">\(\beta = -1\)</span> to define the left channel
as a side channel, which tells the grid generator to squeeze in there a
little more naturally. Note that if we add to points that atre
<span class="math">\(-1\)</span>, we&#8217;ll need to add others that are <span class="math">\(+1\)</span> to seem the
domain &#8220;square&#8221; (i.e., <span class="math">\(\sum \beta = 4\)</span>).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_11_0.png" src="../_images/basics_11_0.png" />
<p>There, now we have a lovely, uniform grid throughout the domain.</p>
</div>
<div class="section" id="using-focus">
<h2>Using focus<a class="headerlink" href="#using-focus" title="Permalink to this headline">¶</a></h2>
<p>What if the side channel was much more narrow than the example above,
but we still wanted to model it with at least 4 grid nodes in the
y-direction?</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_14_0.png" src="../_images/basics_14_0.png" />
<p>One option would be to take a brute-force approach and increase the grid
resolution until we have 4 nodes in the side channel.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_16_0.png" src="../_images/basics_16_0.png" />
<p>For such a simple case, this would be fine. However, in more complex
models, this could dramatically increase the computational burden of the
model. Instead, we could make the <em>y-</em>resolution of the nodes more
dense in the side channel, and more sparse else where.</p>
<p>To accomplish this, we use a concept introduced in the <code class="docutils literal"><span class="pre">prgridgen</span></code>
library called &#8220;focus&#8221;. Focus basically applies a gaussian
transformation of the coordinates of the nodes.</p>
<p>To use focus, you first create an empty <code class="docutils literal"><span class="pre">focus</span></code> object. Then use the
:meth:<code class="docutils literal"><span class="pre">~pygridgen.Focus.add_focus</span></code> method to create an area of focus.
The parameters for <code class="docutils literal"><span class="pre">add_focus</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pos</span></code>, <code class="docutils literal"><span class="pre">axis</span></code>: the relative position and axis at which the focus
will be places</li>
<li><code class="docutils literal"><span class="pre">factor</span></code>: the scaling factor to be applied to the node density</li>
<li><code class="docutils literal"><span class="pre">extent</span></code>: the relative &#8220;area of influence&#8221; of the focus area.</li>
</ul>
<p><code class="docutils literal"><span class="pre">pos</span></code> and <code class="docutils literal"><span class="pre">extent</span></code> are in relative grid coordinates. In other words,
they range from 0 to 1. The value of <code class="docutils literal"><span class="pre">axis</span></code> is either <code class="docutils literal"><span class="pre">&quot;x&quot;</span></code> or
<code class="docutils literal"><span class="pre">&quot;y&quot;</span></code>, and factor should be greater than 1 to make the nodes more
dense or less than one to make them more sparse.</p>
<p>To continue with our running example, let&#8217;s focus in the points in the
size channel (<code class="docutils literal"><span class="pre">pos=0.5,</span> <span class="pre">axis='y'</span></code>) so that we get 4 rows of nodes in
there.</p>
<p>Unrelated to focus, let&#8217;s bump up the column count to 20 so that when we
use use <code class="docutils literal"><span class="pre">factor</span> <span class="pre">&lt;</span> <span class="pre">1</span></code> in the main body, it&#8217;s more obvious.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_18_0.png" src="../_images/basics_18_0.png" />
<p>The interactions between <code class="docutils literal"><span class="pre">factor</span></code> and <code class="docutils literal"><span class="pre">extent</span></code> can be tricky. The
example above applies a 5x focus to the middle 25% of the grid
(<code class="docutils literal"><span class="pre">extent</span> <span class="pre">=</span> <span class="pre">0.25</span></code>). However, if we instead apply the focus to 50% of
the grid, we no longer achieve our goal of having 3 nodes in the side
channel.</p>
<p><code class="docutils literal"><span class="pre">¯\_(ツ)_/¯</span></code></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_20_0.png" src="../_images/basics_20_0.png" />
<p>So now, let&#8217;s make the horizontal resolution of the main body more
sparse by using a <code class="docutils literal"><span class="pre">factor</span> <span class="pre">&lt;</span> <span class="pre">1</span></code>. This will have the side-effect of make
the horizontal channel more dense.</p>
<p>Thinking through this: - we want to make the columns more dense, so
<code class="docutils literal"><span class="pre">dir='x'</span></code> - in total, we have 20 <em>x-</em>nodes - the center of the main
body is at about the 5th node, so <code class="docutils literal"><span class="pre">pos=5/20</span></code> - the main body is about
10 nodes wide, so <code class="docutils literal"><span class="pre">extent=10/20</span></code>.</p>
<p>Let&#8217;s try this out with a <code class="docutils literal"><span class="pre">factor=0.5</span></code> and see how things are when
they&#8217;re half as dense:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_22_0.png" src="../_images/basics_22_0.png" />
<p>Wait second, the <em>side channel</em> got less dense. What&#8217;s going?</p>
<p>Well, we avoiding this successfully so far, but it finally bit us. By
default, <code class="docutils literal"><span class="pre">pygridgen</span></code> assumes that the first coordinate pair of the
boundary is the &#8220;upper left&#8221;. But in this case, it&#8217;s acutally the lower
left. So a few things are backards. We can deal with it in two ways.</p>
<p>In the first, we simple move where we apply the focus to <code class="docutils literal"><span class="pre">x=15/20</span></code>
instead of <code class="docutils literal"><span class="pre">5/20</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_24_0.png" src="../_images/basics_24_0.png" />
<p>Or, we could use the <code class="docutils literal"><span class="pre">ul_idx</span></code> parameter to tell <code class="docutils literal"><span class="pre">pygridgen</span></code> the
index of the coordinate of the upper left corner our boundary. For this
example, the upper left coordinates are the 8th items in their arrays,
so the index is <code class="docutils literal"><span class="pre">7</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span> <span class="n">ul_idx</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/basics_26_0.png" src="../_images/basics_26_0.png" />
</div>
<div class="section" id="on-the-upper-left-index-parameter">
<h2>On the upper left index parameter<a class="headerlink" href="#on-the-upper-left-index-parameter" title="Permalink to this headline">¶</a></h2>
<p>This upper left index thing can really twist your mind around with more
complex shapes, so let&#8217;s use the simplest case to demostrate it&#8217;s
effects.</p>
<p>We&#8217;ll use a simple rectangle with a 10 x 21 grid, with focus at
<code class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">7/21</span></code> and <code class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">7/10</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">focus</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Focus</span><span class="p">()</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.33</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">focus</span><span class="o">.</span><span class="n">add_focus</span><span class="p">(</span><span class="mf">0.70</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pygridgen</span><span class="o">.</span><span class="n">Gridgen</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">focus</span><span class="o">=</span><span class="n">focus</span><span class="p">,</span> <span class="n">ul_idx</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;upper left index = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/basics_28_0.png" src="../_images/basics_28_0.png" />
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gridgen_examples.html" class="btn btn-neutral float-right" title="Examples from the gridgen-c library">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../install/build_osx.html" class="btn btn-neutral" title="Mac OS X: building from source"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Robert Hetland.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>